<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database - NIA Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #10b981;
            --code-bg: #1e293b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .logo {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .logo h1 {
            font-size: 1.75rem;
            color: var(--primary);
            font-weight: 800;
        }

        .logo p {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .nav-link {
            display: block;
            padding: 0.75rem 1.5rem;
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background: rgba(99, 102, 241, 0.1);
            border-left-color: var(--primary);
        }

        .nav-link.active {
            background: rgba(99, 102, 241, 0.15);
            border-left-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        /* Content */
        .content {
            margin-left: 280px;
            flex: 1;
            padding: 3rem;
            max-width: 1200px;
        }

        .header {
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header .subtitle {
            color: var(--text-muted);
            font-size: 1.125rem;
        }

        section {
            margin-bottom: 4rem;
        }

        h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border);
        }

        h3 {
            font-size: 1.5rem;
            margin: 2rem 0 1rem;
            color: var(--primary);
        }

        h4 {
            font-size: 1.25rem;
            margin: 1.5rem 0 1rem;
        }

        p, ul, ol {
            margin-bottom: 1rem;
            color: var(--text-muted);
        }

        ul, ol {
            margin-left: 1.5rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        pre {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1.5rem;
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }

        code {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            color: #a5b4fc;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: rgba(99, 102, 241, 0.1);
            font-weight: 600;
            color: var(--primary);
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-top: 0.5rem;
        }

        .badge-primary { background: rgba(99, 102, 241, 0.2); color: #a5b4fc; }
        .badge-success { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }

        .diagram {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 2rem;
            border-radius: 0.5rem;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .content {
                margin-left: 0;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <h1>ğŸ§  NIA</h1>
                <p>Database Documentation</p>
            </div>

            <a href="index.html" class="nav-link">â† Voltar para Docs</a>
            <a href="#overview" class="nav-link active">VisÃ£o Geral</a>
            <a href="#diagram" class="nav-link">Diagrama ER</a>
            <a href="#users" class="nav-link">Tabela: users</a>
            <a href="#courses" class="nav-link">Tabela: courses</a>
            <a href="#modules" class="nav-link">Tabela: modules</a>
            <a href="#progress" class="nav-link">Tabela: progress</a>
            <a href="#relationships" class="nav-link">Relacionamentos</a>
            <a href="#indexes" class="nav-link">Ãndices</a>
            <a href="#queries" class="nav-link">Queries Comuns</a>
        </nav>

        <!-- Content -->
        <main class="content">
            <!-- Header -->
            <div class="header">
                <h1>ğŸ—„ï¸ Database Schema</h1>
                <p class="subtitle">DocumentaÃ§Ã£o completa do banco de dados PostgreSQL</p>
                <div>
                    <span class="badge badge-primary">PostgreSQL 15</span>
                    <span class="badge badge-success">SQLAlchemy</span>
                    <span class="badge badge-primary">JSONB</span>
                </div>
            </div>

            <!-- Overview -->
            <section id="overview">
                <h2>ğŸ¯ VisÃ£o Geral</h2>
                <p>O banco de dados da plataforma NIA Ã© estruturado para suportar:</p>
                <ul>
                    <li>âœ… GeraÃ§Ã£o e armazenamento de cursos</li>
                    <li>âœ… MÃ³dulos com conteÃºdo rico (texto, cÃ³digo, exemplos)</li>
                    <li>âœ… Sistema de quizzes com mÃºltiplas questÃµes</li>
                    <li>âœ… Acompanhamento de progresso individual</li>
                    <li>âœ… GamificaÃ§Ã£o (pontos, badges, nÃ­veis)</li>
                    <li>âœ… Metadados de geraÃ§Ã£o por IA</li>
                </ul>

                <div class="card">
                    <h4>Tecnologias</h4>
                    <ul>
                        <li><strong>PostgreSQL 15</strong> - Banco relacional</li>
                        <li><strong>SQLAlchemy</strong> - ORM Python</li>
                        <li><strong>Alembic</strong> - Migrations</li>
                        <li><strong>JSONB</strong> - Dados semi-estruturados</li>
                    </ul>
                </div>
            </section>

            <!-- Diagrama ER -->
            <section id="diagram">
                <h2>ğŸ“Š Diagrama ER</h2>
                <div class="diagram">
                    <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       users         â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)             â”‚
â”‚ email               â”‚
â”‚ name                â”‚
â”‚ total_points        â”‚
â”‚ level               â”‚
â”‚ badges (JSONB)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1:N
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      courses        â”‚ 1:N     â”‚      modules        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)             â”‚         â”‚ id (PK)             â”‚
â”‚ title               â”‚         â”‚ course_id (FK)      â”‚
â”‚ description         â”‚         â”‚ module_index        â”‚
â”‚ level               â”‚         â”‚ title               â”‚
â”‚ structure (JSONB)   â”‚         â”‚ content (TEXT)      â”‚
â”‚ status              â”‚         â”‚ quiz (JSONB)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                               â”‚
           â”‚ 1:N                           â”‚ 1:N
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    progress     â”‚
                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                â”‚ id (PK)         â”‚
                â”‚ user_id (FK)    â”‚
                â”‚ course_id (FK)  â”‚
                â”‚ module_id (FK)  â”‚
                â”‚ quiz_score      â”‚
                â”‚ status          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
                </div>
            </section>

            <!-- Tabela: users -->
            <section id="users">
                <h2>ğŸ‘¤ Tabela: users</h2>
                <p>Armazena informaÃ§Ãµes dos usuÃ¡rios e gamificaÃ§Ã£o.</p>

                <table>
                    <thead>
                        <tr>
                            <th>Campo</th>
                            <th>Tipo</th>
                            <th>DescriÃ§Ã£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>SERIAL</td>
                            <td>Chave primÃ¡ria</td>
                        </tr>
                        <tr>
                            <td><code>email</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Email Ãºnico do usuÃ¡rio</td>
                        </tr>
                        <tr>
                            <td><code>name</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Nome completo</td>
                        </tr>
                        <tr>
                            <td><code>google_id</code></td>
                            <td>VARCHAR(255)</td>
                            <td>ID do Google OAuth</td>
                        </tr>
                        <tr>
                            <td><code>total_points</code></td>
                            <td>INTEGER</td>
                            <td>Pontos acumulados</td>
                        </tr>
                        <tr>
                            <td><code>level</code></td>
                            <td>INTEGER</td>
                            <td>NÃ­vel do usuÃ¡rio (1-100)</td>
                        </tr>
                        <tr>
                            <td><code>badges</code></td>
                            <td>JSONB</td>
                            <td>Array de badges conquistados</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Exemplo de JSONB - badges</h4>
                <pre><code>{
  "badges": [
    {
      "id": "first_steps",
      "name": "First Steps",
      "earned_at": "2025-11-22T10:30:00Z"
    }
  ]
}</code></pre>
            </section>

            <!-- Tabela: courses -->
            <section id="courses">
                <h2>ğŸ“š Tabela: courses</h2>
                <p>Armazena a estrutura completa dos cursos gerados pela IA.</p>

                <table>
                    <thead>
                        <tr>
                            <th>Campo</th>
                            <th>Tipo</th>
                            <th>DescriÃ§Ã£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>SERIAL</td>
                            <td>Chave primÃ¡ria</td>
                        </tr>
                        <tr>
                            <td><code>title</code></td>
                            <td>VARCHAR(255)</td>
                            <td>TÃ­tulo do curso</td>
                        </tr>
                        <tr>
                            <td><code>level</code></td>
                            <td>VARCHAR(50)</td>
                            <td>basic, intermediate, advanced</td>
                        </tr>
                        <tr>
                            <td><code>duration_hours</code></td>
                            <td>INTEGER</td>
                            <td>DuraÃ§Ã£o estimada em horas</td>
                        </tr>
                        <tr>
                            <td><code>structure</code></td>
                            <td>JSONB</td>
                            <td>Estrutura completa do curso</td>
                        </tr>
                        <tr>
                            <td><code>generated_by</code></td>
                            <td>JSONB</td>
                            <td>Metadados dos agents usados</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>VARCHAR(50)</td>
                            <td>draft, published, archived</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Exemplo de JSONB - structure</h4>
                <pre><code>{
  "modules": [
    {
      "index": 1,
      "title": "IntroduÃ§Ã£o ao Python",
      "duration_hours": 4,
      "topics": ["Sintaxe bÃ¡sica", "VariÃ¡veis"]
    }
  ]
}</code></pre>
            </section>

            <!-- Tabela: modules -->
            <section id="modules">
                <h2>ğŸ“– Tabela: modules</h2>
                <p>Armazena o conteÃºdo detalhado de cada mÃ³dulo.</p>

                <table>
                    <thead>
                        <tr>
                            <th>Campo</th>
                            <th>Tipo</th>
                            <th>DescriÃ§Ã£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>SERIAL</td>
                            <td>Chave primÃ¡ria</td>
                        </tr>
                        <tr>
                            <td><code>course_id</code></td>
                            <td>INTEGER</td>
                            <td>FK para courses</td>
                        </tr>
                        <tr>
                            <td><code>module_index</code></td>
                            <td>INTEGER</td>
                            <td>Ordem do mÃ³dulo no curso</td>
                        </tr>
                        <tr>
                            <td><code>content</code></td>
                            <td>TEXT</td>
                            <td>ConteÃºdo completo (Markdown)</td>
                        </tr>
                        <tr>
                            <td><code>examples</code></td>
                            <td>JSONB</td>
                            <td>Array de exemplos de cÃ³digo</td>
                        </tr>
                        <tr>
                            <td><code>quiz</code></td>
                            <td>JSONB</td>
                            <td>Objeto com questÃµes do quiz</td>
                        </tr>
                        <tr>
                            <td><code>review_score</code></td>
                            <td>DECIMAL(3,1)</td>
                            <td>Nota do Reviewer Agent (0-10)</td>
                        </tr>
                        <tr>
                            <td><code>generated_by</code></td>
                            <td>VARCHAR(100)</td>
                            <td>Nome do agent que gerou</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Exemplo de JSONB - quiz</h4>
                <pre><code>{
  "quiz_title": "AvaliaÃ§Ã£o Python BÃ¡sico",
  "total_points": 100,
  "questions": [
    {
      "id": 1,
      "question": "O que print() faz?",
      "type": "multiple_choice",
      "options": {
        "A": "LÃª dados",
        "B": "Exibe texto",
        "C": "Cria variÃ¡veis"
      },
      "correct_answer": "B",
      "points": 10
    }
  ]
}</code></pre>
            </section>

            <!-- Tabela: progress -->
            <section id="progress">
                <h2>ğŸ“Š Tabela: progress</h2>
                <p>Rastreia o progresso individual em cada mÃ³dulo.</p>

                <table>
                    <thead>
                        <tr>
                            <th>Campo</th>
                            <th>Tipo</th>
                            <th>DescriÃ§Ã£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>SERIAL</td>
                            <td>Chave primÃ¡ria</td>
                        </tr>
                        <tr>
                            <td><code>user_id</code></td>
                            <td>VARCHAR(255)</td>
                            <td>ID do usuÃ¡rio</td>
                        </tr>
                        <tr>
                            <td><code>course_id</code></td>
                            <td>INTEGER</td>
                            <td>FK para courses</td>
                        </tr>
                        <tr>
                            <td><code>module_id</code></td>
                            <td>INTEGER</td>
                            <td>FK para modules</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>VARCHAR(50)</td>
                            <td>not_started, in_progress, completed</td>
                        </tr>
                        <tr>
                            <td><code>quiz_score</code></td>
                            <td>INTEGER</td>
                            <td>PontuaÃ§Ã£o 0-100</td>
                        </tr>
                        <tr>
                            <td><code>quiz_answers</code></td>
                            <td>JSONB</td>
                            <td>Respostas do aluno</td>
                        </tr>
                        <tr>
                            <td><code>tutor_analysis</code></td>
                            <td>JSONB</td>
                            <td>AnÃ¡lise do Tutor Agent</td>
                        </tr>
                        <tr>
                            <td><code>points_earned</code></td>
                            <td>INTEGER</td>
                            <td>Pontos ganhos neste mÃ³dulo</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Exemplo de JSONB - tutor_analysis</h4>
                <pre><code>{
  "score_percentage": 75,
  "strengths": ["Domina sintaxe bÃ¡sica"],
  "weaknesses": ["Dificuldade com operadores"],
  "recommendations": [
    "Revisar seÃ§Ã£o 2.3",
    "Praticar exercÃ­cios 5-7"
  ],
  "ready_for_next_module": false
}</code></pre>
            </section>

            <!-- Relacionamentos -->
            <section id="relationships">
                <h2>ğŸ”— Relacionamentos</h2>
                
                <div class="card">
                    <h4>Cardinalidade</h4>
                    <ul>
                        <li><code>users (1) â”€â”€â”€â”€ (N) progress</code></li>
                        <li><code>courses (1) â”€â”€â”€â”€ (N) modules</code></li>
                        <li><code>courses (1) â”€â”€â”€â”€ (N) progress</code></li>
                        <li><code>modules (1) â”€â”€â”€â”€ (N) progress</code></li>
                    </ul>
                </div>

                <div class="card">
                    <h4>Constraints</h4>
                    <ul>
                        <li><strong>ON DELETE CASCADE:</strong> Se curso for deletado, mÃ³dulos e progresso tambÃ©m sÃ£o</li>
                        <li><strong>UNIQUE:</strong> Um usuÃ¡rio nÃ£o pode ter mÃºltiplos registros para o mesmo mÃ³dulo</li>
                        <li><strong>CHECK:</strong> Valida valores de enums e ranges</li>
                    </ul>
                </div>
            </section>

            <!-- Ãndices -->
            <section id="indexes">
                <h2>âš¡ Ãndices e Performance</h2>
                
                <pre><code>-- Busca por usuÃ¡rio
CREATE INDEX idx_progress_user_id ON progress(user_id);

-- Listagem de cursos
CREATE INDEX idx_courses_status ON courses(status);

-- MÃ³dulos de um curso
CREATE INDEX idx_modules_course ON modules(course_id, module_index);

-- Ranking (leaderboard)
CREATE INDEX idx_users_points ON users(total_points DESC);

-- Busca em tags (JSONB)
CREATE INDEX idx_courses_tags ON courses USING gin(tags);</code></pre>
            </section>

            <!-- Queries -->
            <section id="queries">
                <h2>ğŸ“ Queries Comuns</h2>

                <h3>1. Listar Cursos Publicados</h3>
                <pre><code>SELECT id, title, level, duration_hours
FROM courses
WHERE status = 'published'
ORDER BY created_at DESC
LIMIT 20;</code></pre>

                <h3>2. Progresso do Aluno</h3>
                <pre><code>SELECT 
    m.title AS module_title,
    p.status,
    p.quiz_score,
    p.completed_at
FROM progress p
JOIN modules m ON p.module_id = m.id
WHERE p.user_id = 'user_123'
ORDER BY m.module_index;</code></pre>

                <h3>3. Leaderboard (Ranking)</h3>
                <pre><code>SELECT 
    name,
    total_points,
    level,
    RANK() OVER (ORDER BY total_points DESC) AS rank
FROM users
WHERE total_points > 0
ORDER BY total_points DESC
LIMIT 100;</code></pre>
            </section>

            <!-- Footer -->
            <div style="text-align: center; padding: 3rem 0; border-top: 1px solid var(--border); margin-top: 4rem;">
                <p style="color: var(--text-muted);">
                    <a href="index.html" style="color: var(--primary); text-decoration: none;">â† Voltar para DocumentaÃ§Ã£o Principal</a>
                </p>
                <p style="margin-top: 1rem; color: var(--text-muted);">
                    NIA Platform Â© 2025 | Database Schema v1.0
                </p>
            </div>

        </main>
    </div>

    <script>
        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                    
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
        });

        // Highlight on scroll
        const sections = document.querySelectorAll('section[id]');
        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>